- name: 'Simple file collect'
  description: 'Collect all files from the given location'
  stage: 'Collect'
  tasks:
    - task: 'DirCollector'
      values:
        sort: true
  parameters:
    location:
      delegation: ['DirCollector#location']
    selection:
      delegation: ['DirCollector#selection']
- name: 'format only'
  description: 'Only format identification'
  stage: 'PreProcess'
  tasks:
    - task: 'FormatIdentifier'
  parameters:
    location:
      delegation: ['FormatIdentifier#folder']
- name: 'checksum + format'
  description: 'MD5 checksum test and format identification'
  stage: 'PreProcess'
  tasks:
    - task: 'ChecksumTester'
      values:
        recursive: true
        checksum_type: 'MD5'
    - task: 'FormatIdentifier'
  parameters:
    location:
      delegation: ['FormatIdentifier#folder']
    checksum_file:
      delegation: ['ChecksumTester#checksum_file']
      default: 'md5sums.txt'
- name: 'viruscheck + format identification'
  description: 'Virus check and Format identification'
  stage: 'PreProcess'
  tasks:
    - task: 'VirusChecker'
    - task: 'FormatIdentifier'
  parameters:
    location:
      delegation: ['VirusChecker#folder', 'FormatIdentifier#folder']
- name: 'group + metadata + collection'
  description: 'Group files into IEs, get metadata and create collections'
  stage: 'PreIngest'
  tasks:
    - task: 'FileGrouper'
    - task: 'IeBuilder'
    - task: 'MetadataCollector'
    - task: 'ManifestationBuilder'
    - task: 'CollectionCreator'
  parameters:
    group_regex:
      delegation: ['FileGrouper#group_regex']
    collection_label:
      delegation: ['FileGrouper#collection_label']
    group_name:
      delegation: ['FileGrouper#group_name']
    group_label:
      delegation: ['FileGrouper#group_label']
    file_label:
      delegation: ['FileGrouper#file_label']
    field:
      delegation: ['MetadataCollector#field']
    term:
      delegation: ['MetadataCollector#term']
    collection:
      delegation: ['CollectionCreator#root_collection']
- name: 'METS ingest'
  description: 'Create METS file and submit to the repository'
  stage: 'Ingest'
  tasks:
    - task: 'MetsCreator'
    - task: 'Submitter'
    - task: 'SubmissionChecker'
  parameters:
    retry_count:
      delegation: ['SubmissionChecker#retry_count']
      default: 120
    retry_interval:
      delegation: ['SubmissionChecker#retry_interval']
      default: 30
- name: 'CSV export'
  description: 'Create CSV file with report of ingested IEs'
  stage: 'PostIngest'
  tasks:
    - task: 'Exporter'
  parameters:
    export_format:
      delegation: ['Exporter#export_dir']
      default: 'csv'
    export_dir:
      delegation: ['Exporter#export_dir']
    export_key:
      delegation: ['Exporter#export_key']
      default: 'item.name'
